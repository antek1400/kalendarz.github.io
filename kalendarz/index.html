<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload and Resize Image with Calendar</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        .image-upload-container {
            margin-bottom: 20px;
        }

        .resize-options {
            margin-bottom: 20px;
        }

        .image-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
        }

        canvas {
            border: 1px solid #ccc;
        }

        .calendar-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        .save-button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        .save-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

<div class="image-upload-container">
    <input type="file" id="imageInput" accept="image/*">
</div>

<div class="resize-options">
    <label for="imageSize">Select Image Size:</label>
    <select id="imageSize">
        <option value="540x960">540x960</option>
        <option value="540x540">1080x1080</option>
    </select>
</div>

<div class="image-container">
    <canvas id="canvas"></canvas>
    <div id="calendar" class="calendar-text"></div>
</div>

<button class="save-button" id="saveButton">Save Image</button>

<script>
    // Funkcja do kompresji obrazu
    function compressImage(file, width, height, callback) {
        const reader = new FileReader();
        reader.onload = function (e) {
            const img = new Image();
            img.onload = function () {
                // Ustawiamy wymiary canvas na wybrany rozmiar
                const canvas = document.getElementById('canvas');
                canvas.width = width; // Ustawiamy szerokość canvas
                canvas.height = height; // Ustawiamy wysokość canvas
                const ctx = canvas.getContext('2d');

                // Rysowanie obrazu na canvasie w wybranym rozmiarze (tło)
                ctx.drawImage(img, 0, 0, width, height);

                // Zwracanie skompresowanego obrazu jako Data URL
                const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7);
                callback(compressedDataUrl, canvas);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    // Funkcja do generowania dni w miesiącu
    function getDaysInMonth(year, month) {
        const days = [];
        const date = new Date(year, month, 1);
        while (date.getMonth() === month) {
            days.push(new Date(date));
            date.setDate(date.getDate() + 1);
        }
        return days;
    }

    // Funkcja do rysowania kalendarza na canvasie
    function drawCalendarOnCanvas(canvas, ctx) {
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        const days = getDaysInMonth(year, month);

        const daysPerRow = 7; // 7 dni w tygodniu
        const dayWidth = 40;  // Szerokość każdego dnia
        const dayHeight = 40; // Wysokość każdego dnia
        const margin = 5;     // Margines pomiędzy dniami

        const startX = (canvas.width - (daysPerRow * (dayWidth + margin) - margin)) / 2; // Wyśrodkowanie X
        const startY = (canvas.height - (Math.ceil(days.length / daysPerRow) * (dayHeight + margin) - margin)) / 2; // Wyśrodkowanie Y

        let dayIndex = 0;
        for (let row = 0; row < Math.ceil(days.length / daysPerRow); row++) {
            for (let col = 0; col < daysPerRow; col++) {
                if (dayIndex < days.length) {
                    const day = days[dayIndex];

                    const x = startX + (col * (dayWidth + margin)); // Pozycja X
                    const y = startY + (row * (dayHeight + margin)); // Pozycja Y

                    // Rysowanie każdego dnia na canvasie
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                    ctx.beginPath();
                    ctx.arc(x + dayWidth / 2, y + dayHeight / 2, dayWidth / 2, 0, 2 * Math.PI);
                    ctx.fill();

                    // Rysowanie numeru dnia
                    ctx.fillStyle = '#333';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(day.getDate(), x + dayWidth / 2, y + dayHeight / 2);

                    dayIndex++;
                }
            }
        }
    }

    // Funkcja do zapisywania obrazu
    function saveCanvasImage() {
        const canvas = document.getElementById('canvas');
        const imageUrl = canvas.toDataURL('image/png'); // Pobranie obrazu z canvas
        const link = document.createElement('a');
        link.href = imageUrl;
        link.download = 'image_with_calendar.png'; // Określenie nazwy pliku
        link.click(); // Rozpoczęcie pobierania
    }

    const imageInput = document.getElementById('imageInput');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const sizeSelect = document.getElementById('imageSize');

    // Funkcja do zmiany rozmiaru canvas na podstawie wybranego rozmiaru
    function updateCanvasSize(size) {
        let width, height;
        if (size === '540x960') {
            width = 540;
            height = 960;
        } else if (size === '540x540') {
            width = 540;
            height = 540;
        }
        canvas.width = width;
        canvas.height = height;

        // Aktualizacja szerokości i wysokości samego kontenera dla canvas
        const canvasContainer = document.querySelector('.image-container');
        canvasContainer.style.width = `${width}px`;
        canvasContainer.style.height = `${height}px`;
    }

    imageInput.addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
            const size = sizeSelect.value;
            let width, height;

            // Wybór rozmiaru na podstawie opcji
            if (size === '540x960') {
                width = 540;
                height = 960;
            } else if (size === '540x540') {
                width = 540;
                height = 540;
            }

            // Kompresja obrazu do zadanych wymiarów
            compressImage(file, width, height, function (compressedDataUrl, canvas) {
                const img = new Image();
                img.onload = function () {
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height); // Rysujemy obraz (tło)
                    drawCalendarOnCanvas(canvas, ctx); // Narysowanie kalendarza na canvasie
                };
                img.src = compressedDataUrl;
            });
        }
    });

    // Nasłuchujemy zmiany rozmiaru i aktualizujemy rozmiar canvas
    sizeSelect.addEventListener('change', function () {
        const selectedSize = sizeSelect.value;
        updateCanvasSize(selectedSize);
    });

    // Inicjalizujemy początkowy rozmiar canvas
    updateCanvasSize(sizeSelect.value);

    // Nasłuchujemy kliknięcia w przycisk "Save Image" i zapisujemy obraz
    document.getElementById('saveButton').addEventListener('click', function() {
        saveCanvasImage();
    });

</script>
</body>
</html>
